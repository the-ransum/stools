#!/bin/bash

function safe_exit {
	echo "The script ran into an issue, exiting..."
	exit 1
}

if [ ! -d $HOME/scripts ]; then
	echo "No script directory in users home..."
	mkdir -pv $HOME/scripts
	
	if [ ! -d $HOME/scripts ]; then
		echo "Failed to create directory '$HOME/scripts'"
		safe_exit
	fi
	
	echo "Created directory '$HOME/scripts'"
fi

if [ -d $HOME/scripts/stools ]; then
	echo "Clearing out the old stuff..."
	rm -rfv $HOME/scripts/stools
fi

echo "Downloading repository..."
wget -qN https://github.com/the-ransum/stools/archive/refs/heads/main.zip -o $HOME/tmp/stools.zip

echo "Unzipping repository..."
unzip -j $HOME/tmp/stools.zip -d $HOME/scripts/stools

if [[ ":$PATH:" != *":$HOME/scripts/stools/bin:"* ]]; then
    echo "Adding $HOME/scripts/stools/bin to path."
    echo 'export PATH="$PATH:$HOME/scripts/stools/bin"' >> $HOME/.bashrc
fi

echo "Cleaning up..."
rm -f $HOME/tmp/stools.zip

. $HOME/.bashrc